-- version-b-final-build.sql
-- Self-contained, consolidated build script for version b.
-- Drops and recreates all tables and types, applies all constraints and defaults, and inserts initial data.
-- Use this script to build the complete database schema and seed data for assignment 4 from scratch.
-- Version B: Complete Build Script (Final State)

-- S00 -- drop all objects.sql
DROP TABLE IF EXISTS PUBLIC.account;
DROP TABLE IF EXISTS PUBLIC.inventory;
DROP TABLE IF EXISTS PUBLIC.classification;
DROP TYPE IF EXISTS PUBLIC.account_type;

-- S01-- create account_type.sql
CREATE TYPE PUBLIC.account_type AS ENUM
    ('Client', 'Employee', 'Admin');
--ALTER TYPE PUBLIC.account_type     OWNER TO postgres;


-- Table structure for table 'classification'
CREATE TABLE IF NOT EXISTS PUBLIC.classification (
  classification_id INT GENERATED BY DEFAULT AS IDENTITY,
  classification_name CHARACTER VARYING NOT NULL,
  CONSTRAINT classification_pk PRIMARY KEY (classification_id)
);


-- Add constraints to classification table
ALTER TABLE PUBLIC.classification
  ADD CONSTRAINT classification_name_valid CHECK (classification_name ~ '^[A-Za-z0-9]+$');
ALTER TABLE PUBLIC.classification
  ADD CONSTRAINT classification_name_unique UNIQUE (classification_name);
-- This constraint ensures classification_name contains only letters and numbers (no spaces or special characters)


-- Table structure for table 'inventory' (version b, with all updates)
CREATE TABLE IF NOT EXISTS PUBLIC.inventory (
  inv_id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
  inv_vin CHARACTER VARYING NOT NULL UNIQUE,
  inv_make CHARACTER VARYING NOT NULL,
  inv_model CHARACTER VARYING NOT NULL,
  inv_year CHARACTER(4) NOT NULL,
  inv_description TEXT,
  inv_image CHARACTER VARYING DEFAULT 'No Image Available',
  inv_thumbnail CHARACTER VARYING DEFAULT 'No Image Available',
  inv_price NUMERIC(9,0) DEFAULT 0,
  inv_miles INTEGER,
  inv_color CHARACTER VARYING,
  classification_id INTEGER NOT NULL,
  CONSTRAINT inventory_pk PRIMARY KEY (inv_id),
  CONSTRAINT inventory_price_nonnegative CHECK (inv_price >= 0),
  CONSTRAINT inventory_year_valid CHECK (inv_year::integer >= 1900 AND inv_year::integer <= 2100)
);
ALTER TABLE IF EXISTS PUBLIC.inventory
  ADD CONSTRAINT fk_classification FOREIGN KEY (classification_id)
  REFERENCES PUBLIC.classification (classification_id) MATCH SIMPLE
  ON UPDATE CASCADE
  ON DELETE NO ACTION;


-- S04-- create account.sql
-- Table structure for table 'account'
CREATE TABLE IF NOT EXISTS PUBLIC.account (
    account_id INTEGER NOT NULL GENERATED BY DEFAULT AS IDENTITY,
    account_firstname CHARACTER VARYING NOT NULL,
    account_lastname CHARACTER VARYING NOT NULL,
    account_email CHARACTER VARYING NOT NULL,
    account_password CHARACTER VARYING NOT NULL,
    account_type account_type NOT NULL DEFAULT 'Client'::account_type,
    CONSTRAINT account_pkey PRIMARY KEY (account_id)
);

-- S05-- insert classifications.sql
-- Data for table 'classification'
INSERT INTO PUBLIC.classification (classification_name)
VALUES ('Custom'),
    ('Sport'),
    ('SUV'),
    ('Truck'),
    ('Sedan');

-- S06b-- insert inventory with vin.sql
-- Data for table `inventory` with inv_vin field
INSERT INTO public.inventory (
    inv_vin,
    inv_make,
    inv_model,
    inv_year,
    inv_description,
    inv_image,
    inv_thumbnail,
    inv_price,
    inv_miles,
    inv_color,
    classification_id
  )
VALUES   ('1G1FE1R70J0100001','Chevy','Camaro','2018','If you want to look cool this is the ar you need! This car has great performance at an affordable price. Own it today!','/images/camaro.jpg','/images/camaro-tn.jpg',25000,101222,'Silver',2),
('BAT00000000000001','Batmobile','Custom','2007','Ever want to be a super hero? now you can with the batmobile. This car allows you to switch to bike mode allowing you to easily maneuver through traffic during rush hour.','/images/batmobile.jpg','/images/batmobile-tn.jpg',65000,29887,'Black',1),
('FBI00000000000001','FBI','Surveillance Van','2016','Do you like police shows? You will feel right at home driving this van, comes complete with survalence equipments for and extra fee of $2,000 a month.','/images/survan.jpg','/images/survan-tn.jpg',20000,19851,'Brown',1),
('DOG00000000000001','Dog ','Car','1997','Do you like dogs? Well this car is for you straight from the 90s from Aspen, Colorado we have the orginal Dog Car complete with fluffy ears.','/images/dog-car.jpg','/images/dog-car-tn.jpg',35000,71632,'White',1),
('1C4HJXDG0JW100001','Jeep','Wrangler','2019','The Jeep Wrangler is small and compact with enough power to get you where you want to go. Its great for everyday driving as well as offroading weather that be on the the rocks or in the mud!','/images/wrangler.jpg','/images/wrangler-tn.jpg',28045,41205,'Yellow',3),
('ZHWUR1ZD4GLA00001','Lamborghini','Adventador','2016','This V-12 engine packs a punch in this sporty car. Make sure you wear your seatbelt and obey all traffic laws. ','/images/adventador.jpg','/images/adventador-tn.jpg',417650,71003,'Blue',2),
('AERO0000000000001','Aerocar International','Aerocar','1963','Are you sick of rushhour trafic? This car converts into an airplane to get you where you are going fast. Only 6 of these were made, get them while they last!','/images/aerocar.jpg','/images/aerocar-tn.jpg',700000,18956,'Red',1);
